"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a="http://localhost:5000",u="public/models",_="public/static/images/products",e="public/static/images/banners",i="224x149",v="600x399",s=99,p=new function t(){var n=this;c(this,t),o(this,"_products",void 0),o(this,"loadProducts",function(){var t="".concat(a,"/").concat(u,"/products.json");n._products=fetch(t).then(function(t){return t.json()}).then(function(t){return t})}),o(this,"getProducts",function(e){return e?n._products.then(function(t){return{head:t.head,list:t.list.filter(function(t){return t.category.id===e})}}):n._products}),o(this,"getProduct",function(e){return n._products.then(function(t){t.head;return t.list.filter(function(t){return t.id===e})[0]})}),this.loadProducts()},d=new function t(){var e=this;c(this,t),o(this,"_banners",[]),o(this,"getBanners",function(){return e._banners}),o(this,"setBanners",function(t){e._banners=t})},t=new function t(){var e=this;c(this,t),o(this,"_categories",void 0),o(this,"loadCategories",function(){var t="".concat(a,"/").concat(u,"/categories.json");e._categories=fetch(t).then(function(t){return t.json()}).then(function(t){return t})}),o(this,"getCategories",function(){return e._categories}),this.loadCategories()},f=new function t(){var r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];c(this,t),o(this,"_sum",0),o(this,"_totalCount",0),o(this,"calculateProductSum",function(t,e){return String(Number(t)*Number(e))}),o(this,"getCartSum",function(){return r._sum||0}),o(this,"setCartSum",function(t){r._sum=t}),o(this,"getCartTotalCount",function(){return r._totalCount}),o(this,"setCartTotalCount",function(t){r._totalCount=t}),o(this,"calculateCartSum",function(){r.setCartSum(r._productList.reduce(function(t,e){return t+e.price*e.count},0))}),o(this,"calculateCartTotalCount",function(){r.setCartTotalCount(r._productList.reduce(function(t,e){return t+e.count},0))}),o(this,"getCartProduct",function(e){return r._productList.filter(function(t){return t.id===e})[0]}),o(this,"getCartProducts",function(t){if(!t)return r._productList;for(var e=[],n=0;n<Math.ceil(r._productList.length/t);n++)e[n]=r._productList.slice(n*t,n*t+t);return e}),o(this,"addCartProduct",function(t){r._productList.push(t),r.calculateCartSum(),r.calculateCartTotalCount()}),o(this,"deleteCartProduct",function(e){r._productList.splice(r._productList.findIndex(function(t){return t.id===e}),1),r.calculateCartSum(),r.calculateCartTotalCount()}),o(this,"updateCartProduct",function(e,t){var n=r._productList.findIndex(function(t){return t.id===e});r._productList.splice(n,1,g({},r._productList[n],{},t)),r.calculateCartSum(),r.calculateCartTotalCount()}),o(this,"checkProduct",function(e){return-1!==r._productList.findIndex(function(t){return t.id===e})}),this._productList=e},b=void 0;t.getCategories().then(function(t){t.head;var e=t.list;l(e);for(var n=function(t){var n="category"+e[t].id;p.getProducts(e[t].id).then(function(t){t.head;var e=t.list;document.getElementById(n).innerHTML=y(e).join("")})},r=0;r<e.length;r++)n(r)});function m(t,e){var n=t.target.closest(".products__boxCounterPrice"),r=n.getAttribute("price");n.children[1].children[0].children[0].innerText=f.calculateProductSum(+r,+e)}var l=function(t){document.getElementById("productsWrapper").innerHTML=t.map(function(t){return'\n        <section class="products__promo" id="section'.concat(t.id,'">\n          <h2 class="products__promoCaption" id="').concat(t.code,'">').concat(t.name,'</h2>\n          <div class="products__promoListing" id="category').concat(t.id,'"></div>\n        </section>\n      ')}).join("")},y=function(t){return t.map(function(t){return h(t)})},h=function(t){var e=f.checkProduct(t.id);return'\n      <div class="products__productWrapper" id="product'.concat(t.id,'" product-id="').concat(t.id,'">\n        <div class="products__product">\n          <img src="').concat(_,"/").concat(i,"/").concat(t.image,'" data-img="').concat(t.image,'">\n          <p class="global-caption products__productCaption">').concat(t.title,'</p>\n          <p class="products__productDescription" data-tooltip="').concat(t.description,'">').concat(t.description,'</p>\n          <div class="products__boxCounterPrice" price="').concat(t.price,'">\n            <div class="products__boxCounter">\n              <button class="counter__button counter__buttonIncrease">+</button>\n              <input class="counter__input" type="number" value="').concat(t.count||1,'">\n              <button class="counter__button counter__buttonDecrease">-</button>\n            </div>\n            <div class="products__boxPrice">\n              <p class="products__productPrice"><span class="products__priceSum">\n                ').concat(f.calculateProductSum(t.price,t.count||1),'</span> &#8381;\n              </p>\n            </div>\n          </div>\n          <div class="products__buyBox">\n            <button class="global-buttonPrimary global-buttonSecondary" product-id="').concat(t.id,'">Подробнее</button>\n            ').concat(e?"<span>Товар в&nbsp;корзине</span>":'<button class="global-buttonPrimary">В корзину</button>',"\n          </div>\n        </div>\n      </div>\n    ")},n=document.getElementById("productsWrapper"),C=document.getElementById("tooltipCart"),E=function(){C.style.display="none"};b=h,n.addEventListener("click",function(t){switch(t.target.className){case"counter__button counter__buttonIncrease":s=(i=t).target.closest(".products__productWrapper").getAttribute("product-id"),d=f.checkProduct(+s),(l=i.target.nextElementSibling).value=++l.value,m(i,l.value),d&&f.updateCartProduct(+s,{count:+l.value}),document.getElementById("cartSum").innerText=String(f.getCartSum());break;case"counter__button counter__buttonDecrease":c=(r=t).target.closest(".products__productWrapper").getAttribute("product-id"),o=f.checkProduct(+c),a=r.target.previousElementSibling,u=--a.value,a.value=u<1?1:u,m(r,a.value),o&&f.updateCartProduct(+c,{count:+a.value}),document.getElementById("cartSum").innerText=String(f.getCartSum());break;case"global-buttonPrimary":n=t.target.closest(".products__productWrapper"),e=n.getAttribute("product-id"),p.getProduct(+e).then(function(t){var e=g({},t,{count:+n.children[0].children[3].children[0].children[1].value});f.addCartProduct(e),document.getElementById("cartSum").innerText=String(f.getCartSum()),n.outerHTML=h(e)}),C.style.display="block",setTimeout(E,1500);break;default:return}var n,e,r,c,o,a,u,i,s,d,l}),n.addEventListener("change",function(t){var e=t.target.closest(".products__productWrapper").getAttribute("product-id"),n=f.checkProduct(+e),r=Number(t.target.value);r<0?t.target.value=-1*r:0===r?t.target.value=1:s<=r&&(t.target.value=s),m(t,t.target.value),n&&f.updateCartProduct(+e,{count:+t.target.value}),document.getElementById("cartSum").innerText=String(f.getCartSum())});function B(e,n,r,c){return function(){var t=f.checkProduct(r);"+"===c?e.value=++e.value:"-"===c&&1<e.value&&(e.value=--e.value),document.getElementById("price").innerText=f.calculateProductSum(n,e.value),t&&(f.updateCartProduct(r,{count:+e.value}),document.getElementById("product"+r).outerHTML=b(f.getCartProduct(r))),document.getElementById("cartSum").innerText=String(f.getCartSum())}}function L(){I.style.display="block",setTimeout(T,1500)}var S=document.getElementById("productsWrapper"),P=document.getElementById("myModal"),x=document.getElementById("modalContent"),I=document.getElementById("tooltipCart"),T=function(){I.style.display="none"},w=function t(e){"myModal"!==e.target.id&&"close"!==e.target.id&&"buyButton"!==e.target.id&&"Escape"!==e.code||(P.style.display="none",x.innerHTML="",document.removeEventListener("keydown",t))};S.addEventListener("click",function(t){if("global-buttonPrimary global-buttonSecondary"===t.target.className){P.style.display="block";var m=t.target.getAttribute("product-id");p.getProduct(+m).then(function(t){var e,n,r=f.getCartProduct(+m);x.innerHTML=(e=r||t,n=f.checkProduct(e.id),'\n      <div><span class="modal__close" id="close">&times;</span></div>\n      <div class="modal__contentWrapper" product-id="'.concat(e.id,'">\n          <h2 class="caption modal__caption">').concat(e.title,'</h2>\n          <img src="').concat(_,"/").concat(v,"/").concat(e.image,'" class="modal__image"/>\n          <div class="modal__infoBox">\n              <p class="modal__description">').concat(e.description,'</p>\n              <div class="modal__counter">\n              <div class="counter__wrapper" >\n                <button id="modalButtonIncrease" class="counter__button counter__buttonIncrease">+</button>\n                <input id="modalCount" class="counter__input" type="number" value="').concat(e.count||1,'">\n                <button id="modalButtonDecrease" class="counter__button counter__buttonDecrease">-</button>\n              </div>\n              </div>\n              <div class="modal__buyBox">\n                  <p class="modal__price"><span id="price">\n                    ').concat(f.calculateProductSum(e.price,e.count||1),"</span> &#8381;\n                  </p>\n                   ").concat(n?"<span>Товар в&nbsp;корзине</span>":'<button id="buyButton" class="global-buttonPrimary modal__buyButton" product-id="${productData.id}">В корзину</button>',"\n              </div>\n          </div>\n      </div>\n    "));var c,o,a,u,i,s=document.querySelector("#modalCount"),d=document.querySelector("#modalButtonIncrease"),l=document.querySelector("#modalButtonDecrease"),p=document.querySelector("#buyButton");s.addEventListener("change",(c=t.price,o=+m,function(t){var e=f.checkProduct(o),n=Number(t.target.value);n<0?t.target.value=-1*n:0===n&&(t.target.value=1),document.getElementById("price").innerText=f.calculateProductSum(c,t.target.value),e&&(f.updateCartProduct(o,{count:+t.target.value}),document.getElementById("product"+o).outerHTML=b(f.getCartProduct(o))),document.getElementById("cartSum").innerText=String(f.getCartSum())})),d.addEventListener("click",B(s,t.price,+m,"+")),l.addEventListener("click",B(s,t.price,+m,"-")),r||p.addEventListener("click",(a=t,u=s,i=+m,function(){f.addCartProduct(g({},a,{count:+u.value})),document.getElementById("cartSum").innerText=String(f.getCartSum()),document.getElementById("product"+i).outerHTML=b(f.getCartProduct(i))})),r||p.addEventListener("click",L)}),document.addEventListener("keydown",w)}}),P.addEventListener("click",w);var k=document.getElementById("productsWrapper"),H=document.getElementById("tooltip");k.addEventListener("mouseover",function(t){if("products__productDescription"===t.target.className){var e=t.target.getAttribute("data-tooltip"),n=document.getElementById("headerWrapper").offsetHeight;H.append(e);var r=(u=t.target,{descPosX:window.pageXOffset+u.getBoundingClientRect().x,descPosY:window.pageYOffset+u.getBoundingClientRect().y});H.style.display="block";var c=H.offsetHeight,o=r.descPosY-c,a=r.descPosX+50;o<window.pageYOffset+n&&(o=r.descPosY+t.target.offsetHeight),a<window.pageXOffset&&(a=window.pageXOffset),H.style.top="".concat(o,"px"),H.style.left="".concat(a,"px")}var u}),k.addEventListener("mouseout",function(t){"products__productDescription"===t.target.className&&(H.style.display="none",H.innerHTML='<span class="tooltip__text">Состав: </span>')});var j=1,O=document.getElementById("slideLeft"),D=document.getElementById("slideRight"),M=document.getElementById("header__sliderDots"),A=document.getElementsByClassName("slider__banner"),N="".concat(a,"/").concat(u,"/banners.json");fetch(N).then(function(t){return t.json()}).then(function(t){O.addEventListener("click",V),D.addEventListener("click",z),document.getElementById("sliderDisplay").innerHTML=X(t.banners).join(""),d.setBanners(t.banners),Y(),$(t.banners,j),M.addEventListener("click",F)});function q(t,e,n){var r=Number(e.target.parentElement.children[1].value);"+"===n?e.target.parentElement.children[1].value=r+1:"-"===n&&(e.target.parentElement.children[1].value=1<r?r-1:1),f.updateCartProduct(+t,{count:+e.target.parentElement.children[1].value}),Z(),Q.innerText=String(f.getCartSum()),document.getElementById("product"+t).outerHTML=b(f.getCartProduct(+t))}function R(t){var e,n,r=t.target.closest(".cart__tableRow").getAttribute("itemId");switch(t.target.className){case"counter__button counter__buttonIncrease":q(r,t,"+");break;case"counter__button counter__buttonDecrease":q(r,t,"-");break;case"cart__tableDelete":e=r,n=f.getCartProduct(+e),f.deleteCartProduct(+e),Z(),Q.innerText=String(f.getCartSum()),document.getElementById("product"+e).outerHTML=b(g({},n,{count:1}));break;default:return}}function W(t){var e=t.target.closest(".cart__tableRow").getAttribute("itemId"),n=Number(t.target.value);n<0?t.target.value=-1*n:0===n&&(t.target.value=1),f.updateCartProduct(+e,{count:+t.target.value}),Z(),Q.innerText=String(f.getCartSum(+e)),document.getElementById("product"+e).outerHTML=b(f.getCartProduct(+e))}var X=function(t){return t.map(function(t){return'<a class="slider__banner" id="banner'.concat(t.id,'" ').concat(t.link&&'href="'+t.link+'"','>\n            <img class="slider__image" src="').concat(e,"/").concat(t.name,'">\n        </a>')})},Y=function(){j<2?O.setAttribute("style","display: none"):O.setAttribute("style","display: block"),j>d.getBanners().length-1?D.setAttribute("style","display: none"):D.setAttribute("style","display: block")},z=function(){j>d.getBanners().length-1||(document.getElementById("banner"+j).setAttribute("style","margin-left: -100%"),j++,$(d.getBanners(),j),Y())},V=function(){j<2||(j--,document.getElementById("banner"+j).setAttribute("style","margin-left: 0"),$(d.getBanners(),j),Y())},$=function(t,e){for(var n=[],r=0;r<t.length;r++){var c=e===r+1?'<span class="header__dot header__dot_active" id="dot'.concat(r,'"></span>'):'<span class="header__dot" id="dot'.concat(r,'"></span>');n.push(c)}document.getElementById("header__sliderDots").innerHTML=n.join("")},F=function(t){if("header__dot"===t.target.className){var e=Number(t.target.id.match(/\d+/));if(j<e+1)for(var n=0;n<e;n++)A[n].style.marginLeft="-100%";else for(var r=0;r<j-1;r++)r<e||(A[r].style.marginLeft="0");j=e+1,$(d.getBanners(),j),Y()}},J=document.getElementById("cartButton"),G=document.getElementById("cartBody"),K=document.getElementById("root"),Q=document.getElementById("cartSum"),U=!1,Z=function(){var t=f.getCartProducts();if(0===t.length)document.getElementById("cartBody").innerHTML="\n        В корзине пока-что нет товаров\n      ";else{var e=t.map(function(t,e){return'\n      <tr class="cart__tableRow" itemId="'.concat(t.id,'">\n        <td class="cart__tableCell">').concat(e+1,'</td>\n        <td class="cart__tableCell">\n          <img \n            src="').concat(_,"/").concat(i,"/").concat(t.image,'" \n            alt="').concat(t.title,'" \n            class="cart__productImage"\n          >\n        </td>\n        <td class="cart__tableCell">').concat(t.title,'</td>\n        <td class="cart__tableCell">\n          <div class="counter__wrapper" >\n            <button class="counter__button counter__buttonIncrease">+</button>\n            <input class="counter__input" type="number" value="').concat(t.count,'">\n            <button class="counter__button counter__buttonDecrease">-</button>\n          </div>\n        </td>\n        <td class="cart__tableCell">').concat(f.calculateProductSum(t.price,t.count),' &#8381;</td>\n        <td class="cart__tableCell"><span class="cart__tableDelete">×</span></td>\n      </tr>\n    ')});document.getElementById("cartBody").innerHTML='\n      <table class="cart__table">\n        <tbody>\n          <tr>\n            <th class="cart__tableHeader">№</th>\n            <th class="cart__tableHeader"></th>\n            <th class="cart__tableHeader">Название</th>\n            <th class="cart__tableHeader">Количество</th>\n            <th class="cart__tableHeader">Сумма</th>\n            <th class="cart__tableHeader"></th>\n          </tr>\n          '.concat(e.join(""),'\n        </tbody>\n      </table>\n      <hr noshade class="cart__divider">\n      <div class="cart__total">\n        <div>\n          <p>Всего товаров: <span class="cart__totalValues">').concat(f.getCartTotalCount(),'</span></p>\n          <p>На сумму: <span class="cart__totalValues">').concat(f.getCartSum(),' &#8381;</span></p>\n        </div>\n        <button class="global-buttonPrimary cart__buyButton">Оформить заказ</button>\n      </div>\n    ');for(var n=document.getElementsByClassName("cart__tableRow"),r=0;r<n.length;r++)n[r].addEventListener("click",R),n[r].addEventListener("change",W)}};J.addEventListener("click",function(){if(!1===U){G.style.display="block",Z();document.getElementById("orderContent").innerHTML='\n      <div><span class="modal__close" id="close">&times;</span></div>\n      <form class="cart__form">\n         <input class="cart__form_item" name="name" type="text" required placeholder="Ваше имя">\n         <input class="cart__form_item" name="phone" type="text" required placeholder="Ваш телефон">\n         <input class="cart__form_item" name="address" type="text" required placeholder="Ваш адрес">\n      <button type="submit" class="global-buttonPrimary cart__buyButton cart__buyButton_order">Оформить заказ</button>\n      </form>\n      ';var d=function(t){return fetch("./server.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})};document.body.addEventListener("input",function(t){t.preventDefault(),function(t){if("phone"===t.name)if(t.value=t.value.replace(/^\++/g,"+"),t.value=t.value.replace(/[^+0-9]/g,""),/^(\+7)?8?([-()]*\d){10}$/.test(t.value))"Ошибка в этом поле"===t.nextElementSibling.textContent&&t.nextElementSibling.remove();else{var e=document.createElement("div");if(e.classList.add("error"),e.textContent="Ошибка в этом поле",e.style.cssText="color: red; line-height: 0px; height: 15px; font-size: 15px;",t.nextElementSibling&&"Ошибка в этом поле"===t.nextElementSibling.textContent)return;t.insertAdjacentElement("afterend",e)}"name"===t.name&&(t.value=t.value.replace(/[^а-яё\s]/gi,"")),"address"===t.name&&(t.value=t.value.replace(/[^а-яА-Я0-9 ,.?!"';:\-\%()\#]/g,""))}(t.target)}),document.body.addEventListener("submit",function(t){t.preventDefault(),console.log(1),function(t){var e="Что-то пошло не так...",n=document.createElement("div");n.style.cssText="\n          font-size: 1.5 rem;\n          color: #505061;\n          text-align: center;\n          margin-top: 10px;\n          ";var r=t.querySelectorAll("input"),c=t.querySelector('input[name="phone"]'),o=t.querySelector('input[name="name"]');if(""!==c.value||""!==o.value){t.appendChild(n),n.textContent="Загрузка...";var a=new FormData(t),u={};a.forEach(function(t,e){u[e]=t}),d(u).then(function(t){if(!0!==t.ok)throw new Error("status network not 200");n.textContent="Спасибо! Мы скоро с Вами свяжемся!",n&&n.nextElementSibling.remove();for(var e=0;e<r.length;e++)r[e].value="";setTimeout(function(){n.remove()},5e3)}).catch(function(t){n&&n.textContent===e&&n.nextElementSibling.remove(),n.textContent=e,setTimeout(function(){n.delete()},5e3),console.log(t)})}else for(var i=0;i<r.length;i++){var s=document.createElement("div");if(s.textContent="Заполните поле!",s.style.cssText="color: red; line-height: 0px; height: 15px; font-size: 15px;",r[i].nextElementSibling&&"Заполните поле!"===r[i].nextElementSibling.textContent)return;""===r[i].value&&r[i].insertAdjacentElement("afterend",s)}}(t.target)});n=document.getElementById("myOrder"),document.addEventListener("click",function(t){var e=t.target;if(e&&e.classList.contains("cart__buyButton"))n.style.display="block",!0;else{if(e.classList.contains("cart__form")||"input"===e.localName||e.classList.contains("error"))return;e.classList.contains("order__content")&&!e.classList.contains("modal__close")||(n.style.display="none",console.dir(e),!1)}}),U=!U}else G.style.display="none",U=!U;var n}),K.addEventListener("click",function(t){t.target.closest("#cartBody")||t.target.closest("#cartButton")||t.target.closest(".cart__tableRow")||(G.style.display="none",U=!1)});var tt=document.querySelector("#root"),et=document.querySelector("#upButton");window.addEventListener("scroll",function(){tt.getBoundingClientRect().y<-300?et.style.opacity="1":et.style.opacity="0"}),et.addEventListener("click",function t(){tt.getBoundingClientRect().y<0&&(window.scrollBy(0,-100),setTimeout(t,20))});for(var nt=document.getElementsByClassName("navigation__link"),rt=document.querySelector(".header__wrapper").offsetHeight,ct=document.getElementsByClassName("products__promo"),ot=function(t){var e,n=t.target.getAttribute("to"),r=document.getElementById(n),c=(e=r,document.documentElement.scrollTop+e.getBoundingClientRect().y)-rt;window.scrollTo({top:c,behavior:"smooth"})},at=0;at<nt.length;at++)nt[at].addEventListener("click",ot);window.addEventListener("scroll",function(){for(var t=0;t<ct.length;t++)ct[t].getBoundingClientRect().y<=130&&ct[t].getBoundingClientRect().y>130-ct[t].getBoundingClientRect().height-50?nt[t].style.color="#822f37":nt[t].style.color="#dadada"});function ut(){var n=document.querySelector("#phoneBody"),r=!1;document.documentElement.clientWidth<768&&document.addEventListener("click",function(t){var e=t.target;r?r&&(e.classList.contains("phone__body")||(n.style.display="none",r=!1)):(e=e.closest(".header__phone_icon"))&&e.classList.contains("header__phone_icon")&&(console.log(e),n.style.display="block",r=!0)})}ut(),window.addEventListener("resize",function(){ut()});