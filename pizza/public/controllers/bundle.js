"use strict";function c(e,t){var n,c=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),c.push.apply(c,n)),c}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var p="public/static/images/products",a="224x149",g="600x399",u=99,t=function t(){var e=this;r(this,t),o(this,"_banners",[]),o(this,"getBanners",function(){return e._banners}),o(this,"setBanners",function(t){e._banners=t})},e=function t(){var c=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];r(this,t),o(this,"_sum",0),o(this,"_totalCount",0),o(this,"calculateProductSum",function(t,e){return String(Number(t)*Number(e))}),o(this,"getCartSum",function(){return c._sum||0}),o(this,"setCartSum",function(t){c._sum=t}),o(this,"getCartTotalCount",function(){return c._totalCount}),o(this,"setCartTotalCount",function(t){c._totalCount=t}),o(this,"calculateCartSum",function(){c.setCartSum(c._productList.reduce(function(t,e){return t+e.price*e.count},0))}),o(this,"calculateCartTotalCount",function(){c.setCartTotalCount(c._productList.reduce(function(t,e){return t+e.count},0))}),o(this,"getCartProduct",function(e){return c._productList.filter(function(t){return t.id===e})[0]}),o(this,"getCartProducts",function(t){if(!t)return c._productList;for(var e=[],n=0;n<Math.ceil(c._productList.length/t);n++)e[n]=c._productList.slice(n*t,n*t+t);return e}),o(this,"addCartProduct",function(t){c._productList.push(t),c.calculateCartSum(),c.calculateCartTotalCount()}),o(this,"deleteCartProduct",function(e){c._productList.splice(c._productList.findIndex(function(t){return t.id===e}),1),c.calculateCartSum(),c.calculateCartTotalCount()}),o(this,"updateCartProduct",function(e,t){var n=c._productList.findIndex(function(t){return t.id===e});c._productList.splice(n,1,m(m({},c._productList[n]),t)),c.calculateCartSum(),c.calculateCartTotalCount()}),o(this,"checkProduct",function(e){return-1!==c._productList.findIndex(function(t){return t.id===e})}),this._productList=e},n=function t(){var e=this;r(this,t),o(this,"_categories",void 0),o(this,"loadCategories",function(){e._categories=fetch("https://d-gladneva.github.io/pizza/public/models/categories.json").then(function(t){return t.json()}).then(function(t){return t})}),o(this,"getCategories",function(){return e._categories}),this.loadCategories()},i=new function t(){var n=this;r(this,t),o(this,"_products",void 0),o(this,"loadProducts",function(){n._products=fetch("https://d-gladneva.github.io/pizza/public/models/products.json").then(function(t){return t.json()}).then(function(t){return t})}),o(this,"getProducts",function(e){return e?n._products.then(function(t){return{head:t.head,list:t.list.filter(function(t){return t.category.id===e})}}):n._products}),o(this,"getProduct",function(e){return n._products.then(function(t){t.head;return t.list.filter(function(t){return t.id===e})[0]})}),this.loadProducts()},t=(new t,new n),_=new e,v=void 0;t.getCategories().then(function(t){t.head;var n=t.list;d(n);for(var c=0;c<n.length;c++)!function(){var e="category"+n[c].id;i.getProducts(n[c].id).then(function(t){t.head;t=t.list;document.getElementById(e).innerHTML=s(t).join("")})}()});function l(t,e){var n=t.target.closest(".products__boxCounterPrice"),t=n.getAttribute("price");n.children[1].children[0].children[0].innerText=_.calculateProductSum(+t,+e)}var d=function(t){document.getElementById("productsWrapper").innerHTML=t.map(function(t){return'\n        <section class="products__promo" id="section'.concat(t.id,'">\n          <h2 class="products__promoCaption" id="').concat(t.code,'">').concat(t.name,'</h2>\n          <div class="products__promoListing" id="category').concat(t.id,'"></div>\n        </section>\n      ')}).join("")},s=function(t){return t.map(function(t){return y(t)})},y=function(t){var e=_.checkProduct(t.id);return'\n<div class="products__productWrapper" id="product'.concat(t.id,'" product-id="').concat(t.id,'">\n        <div class="products__product">\n          <img src="').concat(p,"/").concat(a,"/").concat(t.image,'" alt="').concat(t.title,'" data-img="').concat(t.image,'">\n          <p class="global-caption products__productCaption">').concat(t.title,'</p>\n          <p class="products__productDescription" data-tooltip="').concat(t.description,'">').concat(t.description,'</p>\n          <div class="products__boxCounterPrice" price="').concat(t.price,'">\n            <div class="products__boxCounter">\n              <button class="counter__button counter__buttonIncrease">+</button>\n              <label><input class="counter__input" type="number" value="').concat(t.count||1,'"></label>\n              <button class="counter__button counter__buttonDecrease">-</button>\n            </div>\n            <div class="products__boxPrice">\n              <p class="products__productPrice"><span class="products__priceSum">\n                ').concat(_.calculateProductSum(t.price,t.count||1),'</span> &#8381;\n              </p>\n            </div>\n          </div>\n          <div class="products__buyBox">\n            <button class="global-buttonPrimary global-buttonSecondary" product-id="').concat(t.id,'">Подробнее</button>\n            ').concat(e?"<span>Товар в&nbsp;корзине</span>":'<button class="global-buttonPrimary">В корзину</button>',"\n            </div>\n          </div>\n        </div>\n")},n=document.getElementById("productsWrapper"),f=document.getElementById("tooltipCart"),b=function(){f.style.display="none"},e=function(t){switch(t.target.className){case"counter__button counter__buttonIncrease":r=(c=t).target.closest(".products__productWrapper").getAttribute("product-id"),o=_.checkProduct(+r),(a=c.target.nextElementSibling).value=++a.value,l(c,a.value),o&&_.updateCartProduct(+r,{count:+a.value}),document.getElementById("cartSum").innerText=String(_.getCartSum());break;case"counter__button counter__buttonDecrease":o=(c=t).target.closest(".products__productWrapper").getAttribute("product-id"),r=_.checkProduct(+o),e=c.target.previousElementSibling,a=--e.value,e.value=a<1?1:a,l(c,e.value),r&&_.updateCartProduct(+o,{count:+e.value}),document.getElementById("cartSum").innerText=String(_.getCartSum());break;case"global-buttonPrimary":e=(n=(e=t).target.closest(".products__productWrapper")).getAttribute("product-id"),i.getProduct(+e).then(function(t){var e=+n.children[0].children[3].children[0].children[1].value,e=m(m({},t),{},{count:e});_.addCartProduct(e),document.getElementById("cartSum").innerText=String(_.getCartSum()),n.outerHTML=y(e)}),f.style.display="block",setTimeout(b,1500);break;default:return}var n,e,c,r,o,a};v=y,n.addEventListener("click",e),n.addEventListener("change",function(t){var e=t.target.closest(".products__productWrapper").getAttribute("product-id"),n=_.checkProduct(+e),c=Number(t.target.value);c<0?t.target.value=-1*c:0===c?t.target.value=1:u<=c&&(t.target.value=u),l(t,t.target.value),n&&_.updateCartProduct(+e,{count:+t.target.value}),document.getElementById("cartSum").innerText=String(_.getCartSum())});function h(e,n,c,r){return function(){var t=_.checkProduct(c);"+"===r?e.value=++e.value:"-"===r&&1<e.value&&(e.value=--e.value),document.getElementById("price").innerText=_.calculateProductSum(n,e.value),t&&(_.updateCartProduct(c,{count:+e.value}),document.getElementById("product"+c).outerHTML=v(_.getCartProduct(c))),document.getElementById("cartSum").innerText=String(_.getCartSum())}}function C(){B.style.display="block",setTimeout(P,1500)}var t=document.getElementById("productsWrapper"),E=document.getElementById("myModal"),S=document.getElementById("modalContent"),B=document.getElementById("tooltipCart"),P=function(){B.style.display="none"},e=function(t){var s;"global-buttonPrimary global-buttonSecondary"===t.target.className&&(E.style.display="flex",s=t.target.getAttribute("product-id"),i.getProduct(+s).then(function(t){var e=_.getCartProduct(+s);S.innerHTML=(l=e||t,d=_.checkProduct(l.id),'\n      <div><span class="modal__close" id="close">&times;</span></div>\n      <div class="modal__contentWrapper" product-id="'.concat(l.id,'">\n          <h2 class="caption modal__caption">').concat(l.title,'</h2>\n          <img src="').concat(p,"/").concat(g,"/").concat(l.image,'\n" class="modal__image"/>\n          <div class="modal__infoBox">\n              <p class="modal__description">').concat(l.description,'</p>\n              <div class="modal__counter">\n              <div class="counter__wrapper" >\n                <button id="modalButtonIncrease" class="counter__button counter__buttonIncrease">+</button>\n                <input id="modalCount" class="counter__input" type="number" value="').concat(l.count||1,'">\n                <button id="modalButtonDecrease" class="counter__button counter__buttonDecrease">-</button>\n              </div>\n              </div>\n              <div class="modal__buyBox">\n                  <p class="modal__price"><span id="price">\n                    ').concat(_.calculateProductSum(l.price,l.count||1),"</span> &#8381;\n                  </p>\n                   ").concat(d?"<span>Товар в&nbsp;корзине</span>":'<button id="buyButton" class="global-buttonPrimary modal__buyButton" product-id="${productData.id}">В корзину</button>',"\n              </div>\n          </div>\n      </div>\n    "));var c,r,n,o,a,u=document.querySelector("#modalCount"),i=document.querySelector("#modalButtonIncrease"),l=document.querySelector("#modalButtonDecrease"),d=document.querySelector("#buyButton");u.addEventListener("change",(c=t.price,r=+s,function(t){var e=_.checkProduct(r),n=Number(t.target.value);n<0?t.target.value=-1*n:0===n&&(t.target.value=1),document.getElementById("price").innerText=_.calculateProductSum(c,t.target.value),e&&(_.updateCartProduct(r,{count:+t.target.value}),document.getElementById("product"+r).outerHTML=v(_.getCartProduct(r))),document.getElementById("cartSum").innerText=String(_.getCartSum())})),i.addEventListener("click",h(u,t.price,+s,"+")),l.addEventListener("click",h(u,t.price,+s,"-")),e||d.addEventListener("click",(n=t,o=u,a=+s,function(){_.addCartProduct(m(m({},n),{},{count:+o.value})),document.getElementById("cartSum").innerText=String(_.getCartSum()),document.getElementById("product"+a).outerHTML=v(_.getCartProduct(a))})),e||d.addEventListener("click",C)}),document.addEventListener("keydown",L))},L=function t(e){"myModal"!==e.target.id&&"close"!==e.target.id&&"buyButton"!==e.target.id&&"Escape"!==e.code||(E.style.display="none",S.innerHTML="",document.removeEventListener("keydown",t))};t.addEventListener("click",e),E.addEventListener("click",L);var n=function(t){var e,n,c,r;"products__productDescription"===t.target.className&&(c=t.target.getAttribute("data-tooltip"),e=document.getElementById("headerWrapper").offsetHeight,x.append(c),r=t.target,n={descPosX:window.pageXOffset+r.getBoundingClientRect().x,descPosY:window.pageYOffset+r.getBoundingClientRect().y},x.style.display="block",c=x.offsetHeight,r=n.descPosX+50,(c=n.descPosY-c)<window.pageYOffset+e&&(c=n.descPosY+t.target.offsetHeight),r<window.pageXOffset&&(r=window.pageXOffset),x.style.top="".concat(c,"px"),x.style.left="".concat(r,"px"))},t=document.getElementById("productsWrapper"),x=document.getElementById("tooltip");t.addEventListener("mouseover",n),t.addEventListener("mouseout",function(t){"products__productDescription"===t.target.className&&(x.style.display="none",x.innerHTML='<span class="tooltip__text">Состав: </span>')});var w,e=document.querySelector(".slider-dots"),n=(document.querySelector(".slider-item"),document.querySelectorAll(".slider-item"));document.querySelector(".dot");e.insertAdjacentHTML("beforeEnd",(w=n.length,'\n            <li class="dot"></li>\n        '.repeat(w))),q=document.querySelectorAll(".slider-item"),H=document.querySelector(".slider-content"),document.querySelectorAll(".slider-btn"),O=document.querySelectorAll(".dot"),j=0,H.addEventListener("click",function(t){t.preventDefault();var n=t.target;n.matches(".slider-btn, .dot")&&(T(q,j,"slider-item-active"),T(O,j,"dot-active"),n.matches("#arrow-right")?++j>=q.length&&(j=0):n.matches("#arrow-left")?--j<0&&(j=q.length-1):n.matches(".dot")&&O.forEach(function(t,e){t===n&&(j=e)}),I(q,j,"slider-item-active"),I(O,j,"dot-active"))}),setInterval(k,2e3);function T(t,e,n){t[e].classList.remove(n)}function I(t,e,n){t[e].classList.add(n)}function k(){T(q,j,"slider-item-active"),T(O,j,"dot-active"),++j>=q.length&&(j=0),I(q,j,"slider-item-active"),I(O,j,"dot-active")}var q,H,O,j;function D(t,e,n){var c=Number(e.target.parentElement.children[1].value);"+"===n?e.target.parentElement.children[1].value=c+1:"-"===n&&(e.target.parentElement.children[1].value=1<c?c-1:1),_.updateCartProduct(+t,{count:+e.target.parentElement.children[1].value}),z(),R.innerText=String(_.getCartSum()),document.getElementById("product"+t).outerHTML=v(_.getCartProduct(+t))}function M(t){var e,n,c=t.target.closest(".cart__tableRow").getAttribute("itemId");switch(t.target.className){case"counter__button counter__buttonIncrease":D(c,t,"+");break;case"counter__button counter__buttonDecrease":D(c,t,"-");break;case"cart__tableDelete":e=c,n=_.getCartProduct(+e),_.deleteCartProduct(+e),z(),R.innerText=String(_.getCartSum()),document.getElementById("product"+e).outerHTML=v(m(m({},n),{},{count:1}));break;default:return}}function A(t){var e=t.target.closest(".cart__tableRow").getAttribute("itemId"),n=Number(t.target.value);n<0?t.target.value=-1*n:0===n&&(t.target.value=1),_.updateCartProduct(+e,{count:+t.target.value}),z(),R.innerText=String(_.getCartSum(+e)),document.getElementById("product"+e).outerHTML=v(_.getCartProduct(+e))}var t=document.getElementById("cartButton"),N=document.getElementById("cartBody"),e=document.getElementById("root"),R=document.getElementById("cartSum"),W=!1,z=function(){var t=_.getCartProducts();if(0===t.length)document.getElementById("cartBody").innerHTML="\n        В корзине пока-что нет товаров\n      ";else{t=t.map(function(t,e){return'\n      <tr class="cart__tableRow" itemId="'.concat(t.id,'">\n        <td class="cart__tableCell">').concat(e+1,'</td>\n        <td class="cart__tableCell">\n          <img \n            src="').concat(p,"/").concat(a,"/").concat(t.image,'" \n            alt="').concat(t.title,'" \n            class="cart__productImage"\n          >\n        </td>\n        <td class="cart__tableCell">').concat(t.title,'</td>\n        <td class="cart__tableCell">\n          <div class="counter__wrapper" >\n            <button class="counter__button counter__buttonIncrease">+</button>\n            <input class="counter__input" type="number" value="').concat(t.count,'">\n            <button class="counter__button counter__buttonDecrease">-</button>\n          </div>\n        </td>\n        <td class="cart__tableCell">').concat(_.calculateProductSum(t.price,t.count),' &#8381;</td>\n        <td class="cart__tableCell"><span class="cart__tableDelete">×</span></td>\n      </tr>\n    ')});document.getElementById("cartBody").innerHTML='\n      <table class="cart__table">\n        <tbody>\n          <tr>\n            <th class="cart__tableHeader">№</th>\n            <th class="cart__tableHeader"></th>\n            <th class="cart__tableHeader">Название</th>\n            <th class="cart__tableHeader">Количество</th>\n            <th class="cart__tableHeader">Сумма</th>\n            <th class="cart__tableHeader"></th>\n          </tr>\n          '.concat(t.join(""),'\n        </tbody>\n      </table>\n      <hr noshade class="cart__divider">\n      <div class="cart__total">\n        <div>\n          <p>Всего товаров: <span class="cart__totalValues">').concat(_.getCartTotalCount(),'</span></p>\n          <p>На сумму: <span class="cart__totalValues">').concat(_.getCartSum(),' &#8381;</span></p>\n        </div>\n        <button class="global-buttonPrimary cart__buyButton">Оформить заказ</button>\n      </div>\n    ');for(var e=document.getElementsByClassName("cart__tableRow"),n=0;n<e.length;n++)e[n].addEventListener("click",M),e[n].addEventListener("change",A)}},n=function(){var a,u,e;W=(!1===W?(N.style.display="block",z(),document.getElementById("orderContent").innerHTML='\n      <div><span class="modal__close" id="close">&times;</span></div>\n      <form class="cart__form">\n         <input class="cart__form_item" name="name" type="text" required placeholder="Ваше имя">\n         <input class="cart__form_item" name="email" type="text" required placeholder="Email">\n         <input class="cart__form_item" name="phone" type="text" required placeholder="Телефон">\n         <input class="cart__form_item" name="comment" type="text" placeholder="Комметарий">\n         <input class="cart__form_item" name="street" type="text" required placeholder="Адрес">\n      <button type="submit" class="global-buttonPrimary cart__buyButton cart__buyButton_order">Оформить заказ</button>\n      </form>\n      ',a=document.createElement("div"),u=function(t){return fetch("http://sole-pizza.cxz.su/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m(m({},t),{},{items:_.getCartProducts().map(function(t){return{product:"/api/products/".concat(t.id),quantity:t.count}})}))})},document.body.addEventListener("input",function(t){t.preventDefault(),function(t){if("phone"===t.name)if(t.value=t.value.replace(/^\++/g,"+"),t.value=t.value.replace(/[^+0-9]/g,""),/^(\+7)?8?([-()]*\d){10}$/.test(t.value))"Ошибка в этом поле"===t.nextElementSibling.textContent&&t.nextElementSibling.remove();else{var e=document.createElement("div");if(e.classList.add("error"),e.textContent="Ошибка в этом поле",e.style.cssText="color: red; line-height: 0px; height: 15px; font-size: 15px;",t.nextElementSibling&&"Ошибка в этом поле"===t.nextElementSibling.textContent)return;t.insertAdjacentElement("afterend",e)}"name"!==t.name&&"surname"!==t.name&&"region"!==t.name&&"city"!==t.name&&"street"!==t.name||(t.value=t.value.replace(/[^а-яё\s]/gi,"")),"house"!==t.name&&"building"!==t.name&&"apartment"!==t.name||(t.value=t.value.replace(/[^0-9]/g,"")),"address"!==t.name&&"comment"!==t.name||(t.value=t.value.replace(/[^а-яА-Я0-9 ,.?!"';:\-\%()\#]/g,""))}(t.target)}),document.body.addEventListener("submit",function(t){t.preventDefault(),function(t){a.style.cssText="\n          font-size: 1.5 rem;\n          color: #505061;\n          text-align: center;\n          margin-top: 10px;\n          ";var n=t.querySelectorAll("input"),e=t.querySelector('input[name="phone"]'),c=t.querySelector('input[name="name"]');if(""!==e.value||""!==c.value){t.appendChild(a),a.textContent="Загрузка...",setTimeout(function(){a.delete()},1e3);t={name:document.querySelector('input[name="name"]').value,surname:document.querySelector('input[name="surname"]').value,email:document.querySelector('input[name="email"]').value,phone:document.querySelector('input[name="phone"]').value,comment:document.querySelector('input[name="comment"]').value,address:{city:document.querySelector('input[name="city"]').value,street:document.querySelector('input[name="street"]').value,house:document.querySelector('input[name="house"]').value,building:document.querySelector('input[name="building"]').value,region:document.querySelector('input[name="region"]').value,apartment:document.querySelector('input[name="apartment"]').value}};u(t).then(function(t){if(!0!==t.ok)throw new Error("status network not 200");setTimeout(function(){a.delete()},1e3),a.textContent="Спасибо! Мы скоро с Вами свяжемся!";for(var e=0;e<n.length;e++)n[e].value="";setTimeout(function(){a.remove()},5e3)}).catch(function(t){a.previousSibling||(a.textContent="Что-то пошло не так...",setTimeout(function(){a.delete()},1e3))})}else for(var r=0;r<n.length;r++){var o=document.createElement("div");if(o.textContent="Заполните поле!",o.style.cssText="color: red; line-height: 0px; height: 15px; font-size: 15px;",n[r].nextElementSibling&&"Заполните поле!"===n[r].nextElementSibling.textContent)return;""===n[r].value&&n[r].insertAdjacentElement("afterend",o)}}(t.target)}),e=document.getElementById("myOrder"),document.addEventListener("click",function(t){t=t.target;t&&t.classList.contains("cart__buyButton")?(e.style.display="flex",0):t.classList.contains("modal__close")&&(e.style.display="none",0)})):N.style.display="none",!W)};t.addEventListener("click",n),e.addEventListener("click",function(t){t.target.closest("#cartBody")||t.target.closest("#cartButton")||t.target.closest(".cart__tableRow")||(N.style.display="none",W=!1)});document.querySelector("div");var X=document.querySelector("#root"),Y=document.querySelector("#upButton");window.addEventListener("scroll",function(){X.getBoundingClientRect().y<-300?Y.style.opacity="1":Y.style.opacity="0"}),Y.addEventListener("click",function(){X.getBoundingClientRect().y<0&&window.scrollBy(0,-100)});for(var V=document.getElementsByClassName("navigation__link"),$=document.querySelector(".header__wrapper").offsetHeight,J=document.getElementsByClassName("products__promo"),F=function(t){t=t.target.getAttribute("to"),t=document.getElementById(t),t=(t=t,document.documentElement.scrollTop+t.getBoundingClientRect().y)-$;window.scrollTo({top:t,behavior:"smooth"})},G=0;G<V.length;G++)V[G].addEventListener("click",F);window.addEventListener("scroll",function(){for(var t=0;t<J.length;t++)J[t].getBoundingClientRect().y<=185&&J[t].getBoundingClientRect().y>185-J[t].getBoundingClientRect().height-50?V[t].style.color="#822f37":V[t].style.color="#dadada"});function K(){var e=document.querySelector("#phoneBody"),n=!1;document.documentElement.clientWidth<768&&document.addEventListener("click",function(t){t=t.target;n?n&&(t.classList.contains("phone__body")||(e.style.display="none",n=!1)):(t=t.closest(".header__phone_icon"))&&t.classList.contains("header__phone_icon")&&(e.style.display="block",n=!0)})}K(),window.addEventListener("resize",function(){K()});function Q(){var e=document.querySelector("#popupMenu"),n=!1;document.documentElement.clientWidth<768&&document.addEventListener("click",function(t){t=t.target;n?n&&(t.classList.contains("popup-menu")||(e.style.display="none",n=!1)):(t=t.closest(".navigation__burger"))&&t.classList.contains("navigation__burger")&&(e.style.display="block",n=!0)})}Q(),window.addEventListener("resize",function(){Q()}),function(){for(var n=document.querySelector(".header__wrapper").offsetHeight,t=document.getElementsByClassName("scroll"),e=function(t){var e=t.target,t=(e=e.closest(".test")).getAttribute("the");e&&(t=document.getElementById(t),t=(t=t,document.documentElement.scrollTop+t.getBoundingClientRect().y)-n,window.scrollTo({top:t,behavior:"smooth"}))},c=0;c<t.length;c++)t[c].addEventListener("click",e)}();